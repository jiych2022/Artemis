### Church Admin

- **Application**: Church admin <= 3.6.57

- **Threat Impact**: Sensitive data leakage

- **Code**:

  File: `includes/mailchimp.php`

  ```
  $settings['api_key']=stripslashes( $_POST['api_key'] );
  
  ...
  $MailChimp = new MailChimp( $settings['api_key'] );
  $MailChimp->$action();
  
  class MailChimp {
   public function __construct( $api_key, $api_endpoint = null) {
     $this->api_key = $api_key;
     $data_center = explode('-', $this->api_key)[1];
     $this->api_endpoint = "https://{$data_center}.api.mailchimp.com/3.0";
   }
   
   public function get()
      {
          return $this->makeRequest('get',...);
      }
   
   private function makeRequest( $http_verb,...)
      {
        $url = $this->api_endpoint;
        $ch = curl_init();
        curl_setopt( $ch, CURLOPT_URL, $url);
        curl_exec($ch);
  }
  ```

- **POC**:

  1. Listen on 8080 on server side

  1. Go to the index page of setting, select the commnunications module, go to `Setup Emails`,  find `Setup Mailchimp` under `Bulk email method` 

     Specify `-http://localhost:8888?` as api key

  1. Receive a request on server side. 





