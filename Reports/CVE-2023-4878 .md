### icms2 

- **Application**: icms2 <= 2.16.0

- **Threat Impact**: Sensitive data leak

- **Code**: The url is get from the POST parameter, then passed into `file_get_contents_from_url` function, which later uses `curl_setopt` to set the URL the request will be sent to, causing SSRF.

  File: `system/core/uploader.php`

  ```
   public function uploadFromLink($post_filename, $allowed_ext = false, $allowed_size = 0, $destination = false) {
     $link = trim($_POST[$post_filename]);
     ...
     $file_bin = file_get_contents_from_url($link);
   }
  ```

  File: `system/libs/files.helper.php`

  ```
  function file_get_contents_from_url($url, $timeout = 5, $json_decode = false, $params = []) {
    ...
    $curl = curl_init();
    ...
    curl_setopt($curl, CURLOPT_URL, $url);
    ...
    curl_exec($curl);
  }
  ```

- **POC**:
  1. Listen on 8080 on server side
  1. Upload image from url with `url=http://localhost:8080`
  1. Receive a request on server side. 
